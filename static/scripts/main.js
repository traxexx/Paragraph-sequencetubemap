!function e(t,r,n){function o(i,d){if(!r[i]){if(!t[i]){var s="function"==typeof require&&require;if(!d&&s)return s(i,!0);if(a)return a(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var h=r[i]={exports:{}};t[i][0].call(h.exports,function(e){var r=t[i][1][e];return o(r||e)},h,h.exports,e,t,r,n)}return r[i].exports}for(var a="function"==typeof require&&require,i=0;i<n.length;i++)o(n[i]);return o}({1:[function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}var o=e("./tubemap"),a=n(o),i=e("./paragraph"),d=n(i);document.getElementById("parseButtonParagraph").onclick=function(){var e=void 0,t=void 0,r=void 0,n=$("#jsonerror");n.hide().text("");try{var o=JSON.parse(document.getElementById("textarea2").value);e=d.paragraphExtractNodes(o),t=d.paragraphExtractTracks(o,e),r=d.paragraphExtractReads(o)}catch(e){return console.log(e),void n.show().text("Error creating plot: "+e)}$('.nav-tabs a[href="#TubemapPlot"]').tab("show"),setTimeout(function(){a.create({svgID:"#svg",nodes:e,tracks:t,reads:r})},200)},document.getElementById("downloadButton").onclick=function(){var e=document.getElementById("svg"),t=(new XMLSerializer).serializeToString(e),r=new Blob([t],{type:"image/svg+xml;charset=utf-8"}),n=URL.createObjectURL(r),o=document.createElement("a");o.href=n,o.download="graph.svg",document.body.appendChild(o),o.click(),document.body.removeChild(o)},document.getElementById("inputFileParagraph").addEventListener("change",function(e){var t=document.getElementById("inputFileParagraph").files[0];console.log(t);var r=new FileReader;r.onload=function(e){document.getElementById("textarea2").value=r.result},r.readAsText(t)}),document.getElementById("includeBadAlignCheckbox").onclick=function(){!0===document.getElementById("includeBadAlignCheckbox").checked?d.setIncludeBadAlign(!0):d.setIncludeBadAlign(!1)},document.getElementById("showPositionsCheckbox").onclick=function(){!0===document.getElementById("showPositionsCheckbox").checked?d.setShowPositions(!0):d.setShowPositions(!1)},document.getElementById("useReferenceSequence").onclick=function(){!0===document.getElementById("useReferenceSequence").checked?d.setUseRefSequence(!0):d.setUseRefSequence(!1)},document.getElementById("useReferenceSequenceLong").onclick=function(){!0===document.getElementById("useReferenceSequenceLong").checked?d.setUseRefSequenceLong(!0):d.setUseRefSequenceLong(!1)},d.setReadColoring("mapping"),document.getElementById("readsSingle").onchange=function(){d.setReadColoring("#aaaaaa")},document.getElementById("readsAlternate").onchange=function(){d.setReadColoring("alternate")},document.getElementById("readsAlignmentStatus").onchange=function(){d.setReadColoring("mapping")},document.getElementById("readsStrand").onchange=function(){d.setReadColoring("strand")},d.setReadOpacity(""),document.getElementById("readsOpacityNone").onchange=function(){d.setReadOpacity("")},document.getElementById("readsOpacityMapq").onchange=function(){d.setReadOpacity("mapq")},document.getElementById("readsOpacityGraphMapq").onchange=function(){d.setReadOpacity("graphMapQ")},document.getElementById("linear").onchange=function(){a.setNodeWidthOption(0)},document.getElementById("log2").onchange=function(){a.setNodeWidthOption(1)},document.getElementById("divide100").onchange=function(){a.setNodeWidthOption(2)}},{"./paragraph":2,"./tubemap":4}],2:[function(e,t,r){"use strict";function n(e){f.includeBadAlignFlag=e}function o(e){f.showPositions=e}function a(e){f.useRefSequence=e}function i(e){f.useRefSequenceLong=e}function d(e){f.readColors=e}function s(e){f.readOpacity=e}function c(e){var t=[],r={};return e.nodes.forEach(function(e,n){var o=n+":"+e.name;r[e.name]=n;var a={name:""+n,fullname:o,originalname:e.name,preds:[],succs:[]};if(f.showPositions&&(a.indexOfFirstBase=0),!e.sequence&&e.reference){var i=(e.reference.split(":")[0],e.reference.split(":")[1]),d=parseInt(i.split("-")[0],10),s=parseInt(i.split("-")[1],10);a.sequenceLength=s-d+1,a.custom_stroke="#2fd647",f.useRefSequenceLong||f.useRefSequence&&a.sequenceLength<15?e.hasOwnProperty("reference_sequence")?a.seq=e.reference_sequence:a.seq=new Array(a.sequenceLength+1).join("R"):a.seq=e.reference,f.showPositions&&(a.indexOfFirstBase=d)}else e.sequence&&!e.reference?"source"===e.name||"sink"===e.name?(a.seq=e.name,a.sequenceLength=e.sequence.length):(a.seq=e.sequence,a.sequenceLength=e.sequence.length):console.log("invalid node: ",e);t[n]=a}),e.edges.forEach(function(e){t[r[e.from]].succs.push(t[r[e.to]].name),t[r[e.to]].preds.push(t[r[e.from]].name)}),t}function h(e,t){var r=[],n={},o={};e.nodes.forEach(function(e,t){n[e.name]=t});var a={},i={};e.edges.forEach(function(e,t){a.hasOwnProperty(e.from)?a[e.from].push(e.to):a[e.from]=[e.to],i[e.from+"_"+e.to]=!1});for(var d=!0;d;)!function(){d=!1;for(var t=["0"],o=e.nodes[0].name;o;)!function(){var e=void 0;a[o]&&(Object.values(a[o]).forEach(function(t){e&&i[o+"_"+t]||(e=t,i[o+"_"+t]||(d=!0,i[o+"_"+t]=!0))}),e&&t.push(""+n[e])),o=e}();if(d){var s={};s.id=r.length,s.sequence=t,s.name="AUTO_"+s.id,r.push(s)}}();return e.paths.forEach(function(e,a){var i=[];e.nodes.forEach(function(e,t){var r=""+n[e];i.push(r),o.hasOwnProperty(r)?o[r]+=1:o[r]=1});var d={};d.id=r.length,d.sequence=i,1===d.sequence.length&&1===t[d.sequence[0]].preds.length&&1===t[d.sequence[0]].succs.length&&(d.sequence.unshift(t[d.sequence[0]].preds[0]),d.sequence.push(t[d.sequence[1]].succs[0])),d.name=e.path_id,f.showPositions&&t[Math.abs(i[0])].hasOwnProperty("indexOfFirstBase")&&(d.indexOfFirstBase=t[Math.abs(i[0])].indexOfFirstBase),r.push(d)}),r}function l(e){for(var t=[],r=0,n=0;""!==e;){for(var o="";""!==e&&e[0]>="0"&&e[0]<="9";)o+=e[0],e=e.substr(1);if(o=parseInt(o,10),isNaN(o)){console.log("invalid cigar: "+e);break}if("S"!==e[0]&&"I"!==e[0]&&"D"!==e[0]&&"X"!==e[0]&&"M"!==e[0]&&"="!==e[0]&&"N"!==e[0]){console.log("invalid cigar: "+e);break}var a={op:e[0],length:o,qpos:r,rpos:n},i=e[0];t.push(a),"S"!==i&&"I"!==i&&"X"!==i&&"M"!==i&&"="!==i&&"N"!==i||(r+=o),"D"!==i&&"X"!==i&&"M"!==i&&"="!==i&&"N"!==i||(n+=o),e=e.substr(1)}return t}function u(e,t,r){for(var n=[],o=0;""!==r;){for(var a="";""!==r&&"["!==r[0];)a+=r[0],r=r.substr(1);var i=parseInt(a,10);if("["!==r[0]||isNaN(i)||i>=e.length){console.log("Invalid graph cigar string: "+r);break}r=r.substr(1);for(var d="";""!==r&&"]"!==r[0];)d+=r[0],r=r.substr(1);if("]"!==r[0]||""===d){console.log("Invalid graph cigar string: "+r);break}r=r.substr(1);var s=l(d);if(0===s.length){console.log("Invalid graph cigar string: "+r);break}var c=0,h=0;"S"===s[0].op&&(c=s[0].length),s.length>1&&"S"===s[s.length-1].op&&(h=s[s.length-1].length);var u=0,p=0;s.forEach(function(e){"S"!==e.op&&"I"!==e.op&&"X"!==e.op&&"M"!==e.op&&"="!==e.op&&"N"!==e.op||(p+=e.length,e.qseq=t.substr(e.qpos,e.length)),"D"!==e.op&&"X"!==e.op&&"M"!==e.op&&"="!==e.op&&"N"!==e.op||(u+=e.length),e.qpos+=o}),n.push({node:i,nodename:e[i].name,cigar:d,cigarOps:s,softClipLeft:c,softClipRight:h,refSpan:u,querySpan:p}),o+=p}return n}function p(e){var t=[];if(!e.alignments)return t;var r={};return e.nodes.forEach(function(e,t){r[e.name]=""+t}),e.alignments.forEach(function(n,o){if(f.includeBadAlignFlag||"MAPPED"===n.graphMappingStatus){var a=u(e.nodes,n.bases,n.graphCigar);if(0===a.length)return void console.log("Empty mapping for read "+n);var i=[],d=[];a.forEach(function(e,t){i.push(r[e.nodename]);var o=[];e.cigarOps.forEach(function(e){"I"===e.op||"S"===e.op?o.push({type:"insertion",pos:e.rpos+(0===t?n.graphPos:0),seq:e.qseq?e.qseq:"I"}):"X"===e.op?o.push({type:"substitution",pos:e.rpos+(0===t?n.graphPos:0),seq:e.qseq?e.qseq:new Array(e.length+1).join("X")}):"D"===e.op&&o.push({type:"deletion",pos:e.rpos+(0===t?n.graphPos:0),length:e.length})}),d.push({nodeName:r[e.nodename],mismatches:o})});var s={};if(s.id=e.nodes.length+o,s.sequence=i,s.sequenceNew=d,s.type="read",s.name=n.fragmentId,s.firstNodeOffset=n.graphPos||0,s.finalNodeCoverLength=a[a.length-1].refSpan,1===i.length&&(s.finalNodeCoverLength+=s.firstNodeOffset),"#"===f.readColors[0]?s.custom_color=f.readColors:"strand"===f.readColors?s.is_reverse=n.isGraphReverseStrand:"mapping"===f.readColors&&("MAPPED"===n.graphMappingStatus?s.custom_color="#47d15a":"nonuniq"===n.error?s.custom_color="#ff7b68":"bad_align"===n.error?s.custom_color="#988965":n.error.startsWith("kmer")?s.custom_color="#88217d":s.custom_color="#a6a6a6"),f.readOpacity){var c=Math.min(60,Math.max(0,Number(n[f.readOpacity])));s.opacity=.2+.8*c/60}s.fullRecord=n,s.clickTarget="#readinfo",t.push(s)}}),t}Object.defineProperty(r,"__esModule",{value:!0}),r.setIncludeBadAlign=n,r.setShowPositions=o,r.setUseRefSequence=a,r.setUseRefSequenceLong=i,r.setReadColoring=d,r.setReadOpacity=s,r.paragraphExtractNodes=c,r.paragraphExtractTracks=h,r.paragraphExtractReads=p;var f={includeBadAlignFlag:!0,showPositions:!1,useRefSequence:!0,useRefSequenceLong:!1,readColors:"mapping",readOpacity:"mapq"}},{}],3:[function(e,t,r){"use strict";function n(e){switch(e){case"plainColors":return s;case"reds":return d;case"blues":return i;case"greys":return a;case"lightColors":return c;default:return a}}function o(e){var t=e.append("defs").append("pattern").attr({id:"patternA",width:"7",height:"7",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"});t.append("rect").attr({x:"0",y:"0",width:"7",height:"7",fill:"#FFFFFF"}),t.append("rect").attr({x:"0",y:"0",width:"3",height:"3",fill:"#505050"}),t.append("rect").attr({x:"0",y:"4",width:"3",height:"3",fill:"#505050"}),t.append("rect").attr({x:"4",y:"0",width:"3",height:"3",fill:"#505050"}),t.append("rect").attr({x:"4",y:"4",width:"3",height:"3",fill:"#505050"}),t=e.append("defs").append("pattern").attr({id:"patternB",width:"8",height:"8",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}),t.append("rect").attr({x:"0",y:"0",width:"8",height:"8",fill:"#FFFFFF"}),t.append("rect").attr({x:"0",y:"0",width:"3",height:"3",fill:"#1f77b4"}),t.append("rect").attr({x:"0",y:"5",width:"3",height:"3",fill:"#1f77b4"}),t.append("rect").attr({x:"5",y:"0",width:"3",height:"3",fill:"#1f77b4"}),t.append("rect").attr({x:"5",y:"5",width:"3",height:"3",fill:"#1f77b4"}),t=e.append("defs").append("pattern").attr({id:"plaid0",width:"6",height:"6",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}),t.append("rect").attr({x:"0",y:"0",width:"6",height:"6",fill:"#FFFFFF"}),t.append("rect").attr({x:"0",y:"0",width:"2",height:"2",fill:"#1f77b4"}),t.append("rect").attr({x:"0",y:"4",width:"2",height:"2",fill:"#1f77b4"}),t.append("rect").attr({x:"4",y:"0",width:"2",height:"2",fill:"#1f77b4"}),t.append("rect").attr({x:"4",y:"4",width:"2",height:"2",fill:"#1f77b4"}),t=e.append("defs").append("pattern").attr({id:"plaid1",width:"6",height:"6",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}),t.append("rect").attr({x:"0",y:"0",width:"6",height:"6",fill:"#FFFFFF"}),t.append("rect").attr({x:"0",y:"0",width:"2",height:"2",fill:"#ff7f0e"}),t.append("rect").attr({x:"0",y:"4",width:"2",height:"2",fill:"#ff7f0e"}),t.append("rect").attr({x:"4",y:"0",width:"2",height:"2",fill:"#ff7f0e"}),t.append("rect").attr({x:"4",y:"4",width:"2",height:"2",fill:"#ff7f0e"}),t=e.append("defs").append("pattern").attr({id:"plaid2",width:"6",height:"6",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}),t.append("rect").attr({x:"0",y:"0",width:"6",height:"6",fill:"#FFFFFF"}),t.append("rect").attr({x:"0",y:"0",width:"2",height:"2",fill:"#2ca02c"}),t.append("rect").attr({x:"0",y:"4",width:"2",height:"2",fill:"#2ca02c"}),t.append("rect").attr({x:"4",y:"0",width:"2",height:"2",fill:"#2ca02c"}),t.append("rect").attr({x:"4",y:"4",width:"2",height:"2",fill:"#2ca02c"}),t=e.append("defs").append("pattern").attr({id:"plaid3",width:"6",height:"6",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}),t.append("rect").attr({x:"0",y:"0",width:"6",height:"6",fill:"#FFFFFF"}),t.append("rect").attr({x:"0",y:"0",width:"2",height:"2",fill:"#d62728"}),t.append("rect").attr({x:"0",y:"4",width:"2",height:"2",fill:"#d62728"}),t.append("rect").attr({x:"4",y:"0",width:"2",height:"2",fill:"#d62728"}),t.append("rect").attr({x:"4",y:"4",width:"2",height:"2",fill:"#d62728"}),t=e.append("defs").append("pattern").attr({id:"plaid4",width:"6",height:"6",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}),t.append("rect").attr({x:"0",y:"0",width:"6",height:"6",fill:"#FFFFFF"}),t.append("rect").attr({x:"0",y:"0",width:"2",height:"2",fill:"#9467bd"}),t.append("rect").attr({x:"0",y:"4",width:"2",height:"2",fill:"#9467bd"}),t.append("rect").attr({x:"4",y:"0",width:"2",height:"2",fill:"#9467bd"}),t.append("rect").attr({x:"4",y:"4",width:"2",height:"2",fill:"#9467bd"}),t=e.append("defs").append("pattern").attr({id:"plaid5",width:"6",height:"6",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"}),t.append("rect").attr({x:"0",y:"0",width:"6",height:"6",fill:"#FFFFFF"}),t.append("rect").attr({x:"0",y:"0",width:"2",height:"2",fill:"#8c564b"}),t.append("rect").attr({x:"0",y:"4",width:"2",height:"2",fill:"#8c564b"}),t.append("rect").attr({x:"4",y:"0",width:"2",height:"2",fill:"#8c564b"}),t.append("rect").attr({x:"4",y:"4",width:"2",height:"2",fill:"#8c564b"})}Object.defineProperty(r,"__esModule",{value:!0}),r.getColorSet=n,r.defineSVGPatterns=o;var a=r.greys=["#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],i=r.blues=["#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],d=r.reds=["#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],s=r.plainColors=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],c=r.lightColors=["#ABCCE3","#FFCFA5","#B0DBB0","#F0AEAE","#D7C6E6","#C6ABA5","#F4CCE8","#CFCFCF","#E6E6AC","#A8E7ED"]},{}],4:[function(e,t,r){"use strict";function n(e){Ge=e.svgID,$e=d3.select(e.svgID),Ve=JSON.parse(JSON.stringify(e.nodes)),Ze=JSON.parse(JSON.stringify(e.tracks)),Ke=e.reads||null,qt=e.bed||null,ut.clickableNodesFlag=e.clickableNodes||!1,ut.hideLegendFlag=e.hideLegend||!1;p();ut.hideLegendFlag||Ee(),bt||(window.addEventListener("resize",p),bt=!0)}function o(e){Ze.unshift(Ze[e]),Ze.splice(e+1,1),a(0)}function a(e){var t=void 0,r=void 0,n=[],o=void 0,a=void 0;for(o=Ze[e].sequence,t=0;t<o.length;t+=1)"-"===o[t].charAt(0)&&(a=o[t].substr(1),(-1===o.indexOf(a)||o.indexOf(a)>t)&&n.push(o[t].substr(1)));for(t=0;t<Ze.length;t+=1)for(o=Ze[t].sequence,r=0;r<o.length;r+=1)"-"!==o[r].charAt(0)?-1!==n.indexOf(o[r])&&(o[r]="-"+o[r]):-1!==n.indexOf(o[r].substr(1))&&(o[r]=o[r].substr(1));Ve.forEach(function(e){-1!==n.indexOf(e.name)&&(e.seq=e.seq.split("").reverse().join(""))})}function i(e){for(var t=0;t<Ze.length&&Ze[t].id!==e;)t+=1;t<Ze.length&&(Ze[t].hasOwnProperty("hidden")?Ze[t].hidden=!Ze[t].hidden:Ze[t].hidden=!0),p()}function d(){ut.showExonsFlag=!ut.showExonsFlag,p()}function s(e){ut.mergeNodesFlag!==e&&(ut.mergeNodesFlag=e,$e=d3.select(Ge),p())}function c(e){ut.showSoftClips!==e&&(ut.showSoftClips=e,$e=d3.select(Ge),p())}function h(e){ut.showReads!==e&&(ut.showReads=e,$e=d3.select(Ge),p())}function l(e,t){ut[e]=t;p();ut.hideLegendFlag||Ee()}function u(e){0!==e&&1!==e&&2!==e||ut.nodeWidthOption!==e&&(ut.nodeWidthOption=e,void 0!==$e&&($e=d3.select(Ge),p()))}function p(){pt=[],ft=[],gt=[],yt=[],vt=[],st=[],ct=[],ht=[],mt=0,wt=0,xt=0,Et=void 0,$e=d3.select(Ge),$e.selectAll("*").remove(),et=JSON.parse(JSON.stringify(Ve)),tt=JSON.parse(JSON.stringify(Ze)),nt=JSON.parse(JSON.stringify(Ke)),re();for(var e=tt.length-1;e>=0;e-=1)tt[e].hasOwnProperty("type")||(tt[e].type="haplo"),tt[e].hasOwnProperty("hidden")&&!0===tt[e].hidden&&tt.splice(e,1),tt[e].hasOwnProperty("indexOfFirstBase")&&(Et=tt[e].name);it=M(),O(tt),nt&&ut.showReads&&O(nt),Ne(),nt&&ut.mergeNodesFlag&&(C(),D(),nt&&ut.showReads&&k(),Ie(),it=M(),Ne(),O(tt),nt&&ut.showReads&&O(nt)),ot=et.length,at=tt.length,C(),H(),je&&console.log(ot+" nodes."),D(),lt=A(),ee(),Y(),!0===ut.showExonsFlag&&null!==qt&&K(),U(),nt&&ut.showReads&&(f(),k(),O(nt),y(),tt=tt.concat(nt)),rt={},tt.forEach(function(e){rt[e.id]=e}),de(),je&&(console.log("Tracks:"),console.log(tt),console.log("Nodes:"),console.log(et),console.log("Lane assignment:"),console.log(st)),N(),I(),Ye.defineSVGPatterns($e),ve(pt),we(),le(gt,yt),ve(vt),ve(pt,"read"),we("read");var t=F(et);return ue(t),le(gt,yt,"read"),0===ut.nodeWidthOption&&pe(t),void 0!==Et&&fe(),0===ut.nodeWidthOption&&Le(),je&&(console.log("number of tracks: "+at),console.log("number of nodes: "+ot)),tt}function f(){dt=[];for(var e=0;e<=lt;e+=1)dt[e]=[];var t=new Map;et.forEach(function(e){e.hasOwnProperty("order")&&e.hasOwnProperty("y")&&(t.has(e.order)?t.set(e.order,Math.max(e.y+e.contentHeight,t.get(e.order))):t.set(e.order,e.y+e.contentHeight))}),et.forEach(function(e,r){e.hasOwnProperty("order")&&!e.hasOwnProperty("y")&&(console.log("adding to "+e.name),e.y=t.get(e.order)+25,e.contentHeight=0,dt[e.order].push(r))})}function g(){et.forEach(function(e){e.incomingReads=[],e.outgoingReads=[],e.internalReads=[]}),nt.forEach(function(e,t){e.width=7,1===e.path.length?et[e.path[0].node].internalReads.push(t):e.path.forEach(function(r,n){0===n?et[e.path[0].node].outgoingReads.push([t,n]):null!==e.path[n].node&&et[e.path[n].node].incomingReads.push([t,n])})})}function y(){b(),g();var e=et.slice();e.sort(Z),e.forEach(function(e){e.incomingReads.sort(x);var t=e.y+e.contentHeight,r=new Map;e.incomingReads.forEach(function(n){nt[n[0]].path[n[1]].y=t,v(r,nt[n[0]],n[1],t,e),t+=7});var n=t;e.outgoingReads.sort(w);var o=new Map;t=e.y+e.contentHeight,e.outgoingReads.forEach(function(a){nt[a[0]].path[a[1]].y=t,o.set(t,nt[a[0]].firstNodeOffset),!r.has(t)||r.get(t)+1<nt[a[0]].firstNodeOffset?(t+=7,n=Math.max(n,t)):(r.set(t,0),e.incomingReads.forEach(function(n){var o=nt[n[0]],a=o.path[n[1]];a.y>=t&&(a.y+=7,v(r,o,n[1],a.y,e))}),t+=7,n+=7)}),e.internalReads.sort(E),e.internalReads.forEach(function(a){var i=nt[a];for(t=e.y+e.contentHeight;i.firstNodeOffset<r.get(t)+2||i.finalNodeCoverLength>o.get(t)-3;)t+=7;i.path[0].y=t,r.set(t,i.finalNodeCoverLength),n=Math.max(n,t)});var a=n-e.y-e.contentHeight;e.contentHeight+=a,X(e,a)});var t=q(),r=[];nt.forEach(function(e,t){e.path.forEach(function(e,n){e.hasOwnProperty("y")||r.push({readIndex:t,pathIndex:n,previousY:nt[t].path[n-1].y})})}),r.sort(m),r.forEach(function(e){var r=nt[e.readIndex].path[e.pathIndex];r.y=t[r.order],t[r.order]+=nt[e.readIndex].width}),console.log("Reads:"),console.log(nt)}function v(e,t,r,n,o){r===t.path.length-1?e.set(n,t.finalNodeCoverLength):e.set(n,o.sequenceLength)}function m(e,t){var r=nt[e.readIndex].path[e.pathIndex],n=nt[t.readIndex].path[t.pathIndex];return r.order===n.order?e.previousY-t.previousY:r.order-n.order}function w(e,t){for(var r=e[1],n=t[1],o=et[nt[e[0]].path[r].node],a=et[nt[t[0]].path[n].node];null!==o&&null!==a&&o===a;){if(r<nt[e[0]].path.length-1){for(r+=1;null===nt[e[0]].path[r].node;)r+=1;o=et[nt[e[0]].path[r].node]}else o=null;if(n<nt[t[0]].path.length-1){for(n+=1;null===nt[t[0]].path[n].node;)n+=1;a=et[nt[t[0]].path[n].node]}else a=null}if(null!==o)return null!==a?Z(o,a):1;if(null!==a)return-1;var i=nt[e[0]].firstNodeOffset-nt[t[0]].firstNodeOffset;return 0!==i?i:nt[e[0]].finalNodeCoverLength-nt[t[0]].finalNodeCoverLength}function x(e,t){var r=nt[e[0]].path[e[1]-1],n=nt[t[0]].path[t[1]-1];return r.hasOwnProperty("y")?n.hasOwnProperty("y")?r.y-n.y:-1:n.hasOwnProperty("y")?1:x([e[0],e[1]-1],[t[0],t[1]-1])}function E(e,t){var r=nt[e],n=nt[t];return r.firstNodeOffset<n.firstNodeOffset?-1:r.firstNodeOffset>n.firstNodeOffset?1:r.finalNodeCoverLength<n.finalNodeCoverLength?-1:r.finalNodeCoverLength>n.finalNodeCoverLength?1:0}function q(){for(var e=[],t=0;t<=lt;t+=1)e.push(0);return et.forEach(function(t){e[t.order]=Math.max(e[t.order],t.y+t.contentHeight+20)}),tt.forEach(function(t){t.path.forEach(function(r){e[r.order]=Math.max(e[r.order],r.y+t.width)})}),e}function b(){var e=void 0,t=void 0,r=void 0,n=void 0,o=void 0;nt.forEach(function(a){e=Math.abs(a.indexSequence[0]),t=a.indexSequence[0]>=0,r=et[e],a.path=[],a.path.push({order:r.order,isForward:t,node:e});for(var i=1;i<a.sequence.length;i+=1)if(n=r,o=t,e=Math.abs(a.indexSequence[i]),t=a.indexSequence[i]>=0,r=et[e],r.order>n.order){o||a.path.push({order:n.order,isForward:!0,node:null});for(var d=n.order+1;d<r.order;d+=1)a.path.push({order:d,isForward:!0,node:null});t?a.path.push({order:r.order,isForward:!0,node:e}):(a.path.push({order:r.order,isForward:!0,node:null}),a.path.push({order:r.order,isForward:!1,node:e}))}else if(r.order<n.order){o&&a.path.push({order:n.order,isForward:!1,node:null});for(var s=n.order-1;s>r.order;s-=1)a.path.push({order:s,isForward:!1,node:null});t?(a.path.push({order:r.order,isForward:!1,node:null}),a.path.push({order:r.order,isForward:!0,node:e})):a.path.push({order:r.order,isForward:!1,node:e})}else t!==o?a.path.push({order:r.order,isForward:t,node:e}):(a.path.push({order:r.order,isForward:!t,node:null}),a.path.push({order:r.order,isForward:t,node:e}))})}function k(){nt.forEach(function(e){for(var t=0;t<e.sequence.length&&"-"===e.sequence[t].charAt(0);)t+=1;if(t===e.sequence.length){e.is_reverse=!0,e.sequence=e.sequence.reverse();for(var r=0;r<e.sequence.length;r+=1)e.sequence[r]=e.sequence[r].substr(1);e.sequenceNew=e.sequenceNew.reverse();for(var n=0;n<e.sequenceNew.length;n+=1)!function(t){e.sequenceNew[t].nodeName=e.sequenceNew[t].nodeName.substr(1);var r=et[it.get(e.sequenceNew[t].nodeName)].width;e.sequenceNew[t].mismatches.forEach(function(e){"insertion"===e.type?(e.pos=r-e.pos,e.seq=S(e.seq)):"deletion"===e.type?e.pos=r-e.pos-e.length:"substitution"===e.type&&(e.pos=r-e.pos-e.seq.length,e.seq=S(e.seq)),e.hasOwnProperty("seq")&&(e.seq=e.seq.split("").reverse().join(""))})}(n);var o=e.firstNodeOffset,a=et[it.get(e.sequence[0])].sequenceLength;e.firstNodeOffset=a-e.finalNodeCoverLength,a=et[it.get(e.sequence[e.sequence.length-1])].sequenceLength,e.finalNodeCoverLength=a-o}})}function S(e){for(var t="",r=e.length-1;r>=0;r-=1)switch(e.charAt(r)){case"A":t+="T";break;case"T":t+="A";break;case"C":t+="G";break;case"G":t+="C";break;default:t+="N"}return t}function O(e){e.forEach(function(e){e.indexSequence=[],e.sequence.forEach(function(t){"-"===t.charAt(0)?e.indexSequence.push(-it.get(t.substr(1))):e.indexSequence.push(it.get(t))})})}function F(e){var t=e.slice(0),r=void 0;for(r=t.length-1;r>=0;r-=1)t[r].hasOwnProperty("x")||t.splice(r,1);return t}function N(){xt=-99,wt=99,mt=-99,et.forEach(function(e){e.hasOwnProperty("x")&&(xt=Math.max(xt,e.x+20+e.pixelWidth)),e.hasOwnProperty("y")&&(wt=Math.min(wt,e.y-10),mt=Math.max(mt,e.y+e.contentHeight+10))}),tt.forEach(function(e){e.path.forEach(function(t){mt=Math.max(mt,t.y+e.width),wt=Math.min(wt,t.y)})})}function I(){var e=d3.behavior.zoom().scaleExtent([.1,5]).on("zoom",function(){$e.attr("transform","translate("+d3.event.translate+") scale("+d3.event.scale+")")});$e=$e.call(e).on("dblclick.zoom",null).append("g"),e.translate([0,25-wt]),e.event($e);var t=d3.select(Ge);t.attr("height",mt-wt+50),t.attr("width",Math.max(xt,$(Ge).parent().width()))}function M(){return it=new Map,et.forEach(function(e,t){it.set(e.name,t)}),it}function C(){var e=void 0,t=void 0;et.forEach(function(e){e.successors=[],e.predecessors=[]}),tt.forEach(function(r){for(var n=0;n<r.indexSequence.length-1;n+=1)e=Math.abs(r.indexSequence[n]),t=Math.abs(r.indexSequence[n+1]),-1===et[e].successors.indexOf(t)&&et[e].successors.push(t),-1===et[t].predecessors.indexOf(e)&&et[t].predecessors.push(e)}),nt&&ut.showReads&&nt.forEach(function(r){for(var n=0;n<r.indexSequence.length-1;n+=1)e=Math.abs(r.indexSequence[n]),t=Math.abs(r.indexSequence[n+1]),-1===et[e].successors.indexOf(t)&&et[e].successors.push(t),-1===et[t].predecessors.indexOf(e)&&et[t].predecessors.push(e)})}function L(e){var t=0,r=0,n=void 0,o=0;e.forEach(function(e){e<0?(n=et[Math.abs(e)],n.hasOwnProperty("order")||(n.order=r),n.order<o&&(o=n.order),t=n.order,r=n.order-1):(n=et[e],n.hasOwnProperty("order")||(n.order=t),t=n.order+1,r=n.order)}),o<0&&_(-o)}function P(e){var t=0,r=void 0,n=void 0,o=0,a=void 0;try{for(;!et[Math.abs(e[t])].hasOwnProperty("order");)t+=1}catch(r){console.log("Found path that is disjoint with all other paths: "+e),t=0}e[t]>=0?(r=et[e[t]].order-1,a=-1):(r=et[-e[t]].order+1,a=1);for(var i=t-1;i>=0;i-=1)n=et[Math.abs(e[i])],n.hasOwnProperty("order")||(n.order=r,o=Math.min(o,r),r+=a);return o<0&&_(-o),t}function D(){var e=void 0,t=void 0,r=void 0,n=void 0,o=void 0,a=0,i=void 0;i=nt&&ut.showReads?tt.concat(nt):tt,et.forEach(function(e){delete e.order}),L(tt[0].indexSequence);for(var d=1;d<i.length;d+=1)for(je&&console.log("generating order for track "+(d+1)),n=P(i[d].indexSequence),e=B(i[d].indexSequence);n<e.length;){for(o=n,n+=1;n<e.length&&!et[e[n]].hasOwnProperty("order");)n+=1;if(n<e.length){t=et[e[o]].order+1;for(var s=o+1;s<n;s+=1)et[e[s]].order=t,t+=1;if(et[e[n]].order>et[e[o]].order)et[e[n]].order<t&&T(e[n],e[n-1],t);else if(i[d].indexSequence[n]>=0&&!R(e[n],e[o]))T(e[n],e[n-1],t);else if(i[d].sequence[o]<0||et[e[o+1]].degree<2&&et[e[n]].order<et[e[o]].order){t=et[e[o]].order-1;for(var c=o+1;c<n;c+=1)et[e[c]].order=t,t-=1}}else if(i[d].sequence[o]>=0){t=et[e[o]].order+1;for(var h=o+1;h<e.length;h+=1)r=et[e[h]],r.hasOwnProperty("order")||(r.order=t,t+=1)}else{t=et[e[o]].order-1;for(var l=o+1;l<e.length;l+=1)r=et[e[l]],r.hasOwnProperty("order")||(r.order=t,a=Math.min(a,t),t-=1)}}a<0&&_(-a)}function R(e,t){var r=new Array(ot).fill(!1),n=[];for(n.push(e),r[e]=!0;n.length>0;){var o=n.pop();if(o===t)return!0;for(var a=0;a<et[o].successors.length;a+=1){var i=et[o].successors[a];r[i]||(r[i]=!0,n.push(i))}}return!1}function A(){var e=-1;return et.forEach(function(t){t.hasOwnProperty("order")&&t.order>e&&(e=t.order)}),e}function B(e){for(var t=[],r=0;r<e.length;r+=1)e[r]>=0?t.push(e[r]):t.push(-e[r]);return t}function _(e){et.forEach(function(t){t.hasOwnProperty("order")&&(t.order+=e)})}function T(e,t,r){var n=new Map,o=[];o.push([e,r]);for(;o.length>0;)!function(){var r=o.shift(),a=r[0],i=r[1];et[a].hasOwnProperty("order")&&et[a].order<i&&(!n.has(a)||n.get(a)<i)&&(n.set(a,i),et[a].successors.forEach(function(e){et[e].order>et[a].order&&e!==t&&o.push([e,i+1])}),a!==e&&et[a].predecessors.forEach(function(e){et[e].order>a.order&&e!==t&&o.push([e,i+1])}))}();n.forEach(function(e,t){et[t].order=e})}function H(){et.forEach(function(e){e.tracks=[]}),tt.forEach(function(e){e.indexSequence.forEach(function(t){et[Math.abs(t)].tracks.push(e.id)})}),et.forEach(function(e){e.hasOwnProperty("tracks")&&(e.degree=e.tracks.length)})}function U(){var e=0,t=20,r=-1,n=et.slice();n.sort(Z);var o=W();n.forEach(function(n){n.hasOwnProperty("order")&&(n.order>r&&(r=n.order,e=t+10*o[n.order]),n.x=e,t=Math.max(t,e+40+n.pixelWidth))})}function W(){for(var e=[],t=[],r=[],n=0;n<=lt;n+=1)e.push(0),t.push(0);tt.forEach(function(r){for(var n=1;n<r.path.length;n+=1)r.path[n].order===r.path[n-1].order&&(!0===r.path[n].isForward?e[r.path[n].order]+=1:t[r.path[n].order]+=1)}),r.push(Math.max(0,e[0]-1));for(var o=1;o<=lt;o+=1)r.push(Math.max(0,e[o]-1)+Math.max(0,t[o-1]-1));return r}function Y(){for(var e=void 0,t=void 0,r=void 0,n=void 0,o=void 0,a=void 0,i=[],d=0;d<=lt;d+=1){st[d]=[],i[d]=[];for(var s=0;s<at;s+=1)i[d][s]=null}tt.forEach(function(d,s){t=Math.abs(d.indexSequence[0]),r=d.indexSequence[0]>=0,n=et[t],d.path=[],d.path.push({order:n.order,lane:null,isForward:r,node:t}),j(n.order,t,s,0,i),e=1;for(var c=1;c<d.sequence.length;c+=1)if(o=n,a=r,t=Math.abs(d.indexSequence[c]),r=d.indexSequence[c]>=0,n=et[t],n.order>o.order){a||(d.path.push({order:o.order,lane:null,isForward:!0,node:null}),j(o.order,null,s,e,i),e+=1);for(var h=o.order+1;h<n.order;h+=1)d.path.push({order:h,lane:null,isForward:!0,node:null}),j(h,null,s,e,i),e+=1;r?(d.path.push({order:n.order,lane:null,isForward:!0,node:t}),j(n.order,t,s,e,i),e+=1):(d.path.push({order:n.order,lane:null,isForward:!0,node:null}),j(n.order,null,s,e,i),e+=1,d.path.push({order:n.order,lane:null,isForward:!1,node:t}),j(n.order,t,s,e,i),e+=1)}else if(n.order<o.order){a&&(d.path.push({order:o.order,lane:null,isForward:!1,node:null}),j(o.order,null,s,e,i),e+=1);for(var l=o.order-1;l>n.order;l-=1)d.path.push({order:l,lane:null,isForward:!1,node:null}),j(l,null,s,e,i),e+=1;r?(d.path.push({order:n.order,lane:null,isForward:!1,node:null}),j(n.order,null,s,e,i),e+=1,d.path.push({order:n.order,lane:null,isForward:!0,node:t}),j(n.order,t,s,e,i),e+=1):(d.path.push({order:n.order,lane:null,isForward:!1,node:t}),j(n.order,t,s,e,i),e+=1)}else r!==a?(d.path.push({order:n.order,lane:null,isForward:r,node:t}),j(n.order,t,s,e,i),e+=1):(d.path.push({order:n.order,lane:null,isForward:!r,node:null}),j(n.order,null,s,e,i),e+=1,d.path.push({order:n.order,lane:null,isForward:r,node:t}),j(n.order,t,s,e,i),e+=1)});for(var c=0;c<=lt;c+=1)J(st[c],c)}function j(e,t,r,n,o){var a=o[e][r];if(null===t)st[e].push({type:"single",node:null,tracks:[{trackID:r,segmentID:n,compareToFromSame:a}]}),o[e][r]=st[e][st[e].length-1].tracks[0];else{for(var i=0;i<st[e].length;i+=1)if(st[e][i].node===t)return st[e][i].type="multiple",st[e][i].tracks.push({trackID:r,segmentID:n,compareToFromSame:a}),void(o[e][r]=st[e][i].tracks[st[e][i].tracks.length-1]);st[e].push({type:"single",node:t,tracks:[{trackID:r,segmentID:n,compareToFromSame:a}]}),o[e][r]=st[e][st[e].length-1].tracks[0]}}function Q(e,t){var r=void 0;e.forEach(function(e){e.idealLane=0,e.tracks.forEach(function(n){if(0===n.segmentID)n.idealLane=n.trackID,n.idealY=null;else if(tt[n.trackID].path[n.segmentID-1].order===t-1)n.idealLane=tt[n.trackID].path[n.segmentID-1].lane,n.idealY=tt[n.trackID].path[n.segmentID-1].y;else if(n.segmentID<tt[n.trackID].path.length-1&&tt[n.trackID].path[n.segmentID+1].order===t-1)n.idealLane=tt[n.trackID].path[n.segmentID+1].lane,n.idealY=tt[n.trackID].path[n.segmentID+1].y;else{for(r=n.segmentID-1;r>=0&&tt[n.trackID].path[r].order!==t-1;)r-=1;r<0?(n.idealLane=n.trackID,n.idealY=null):(n.idealLane=tt[n.trackID].path[r].lane,n.idealY=tt[n.trackID].path[r].y)}e.idealLane+=n.idealLane}),e.idealLane/=e.tracks.length})}function J(e,t){var r=0,n=new Set,o=20,a=!1,i=-1;Q(e,t),e.sort(V),e.forEach(function(e){null!==e.node?(et[e.node].topLane=r,a&&(o-=10),et[e.node].y=o,et[e.node].contentHeight=0,a=!1):(a?o-=25:o>20&&(o-=10),a=!0),e.tracks.sort(V),e.tracks.forEach(function(t){t.lane=r,t.trackID===i&&null===e.node&&a&&(o+=10),tt[t.trackID].path[t.segmentID].lane=r,tt[t.trackID].path[t.segmentID].y=o,null!==t.idealY&&n.add(t.idealY-o),r+=1,o+=tt[t.trackID].width,null!==e.node&&(et[e.node].contentHeight+=tt[t.trackID].width),i=t.trackID}),o+=25}),z(e,n)}function z(e,t){var r=0,n=Number.MAX_SAFE_INTEGER;t.forEach(function(t){G(e,t)<n&&(n=G(e,t),r=t)}),e.forEach(function(e){null!==e.node&&(et[e.node].y+=r),e.tracks.forEach(function(e){tt[e.trackID].path[e.segmentID].y+=r})})}function X(e,t){e.hasOwnProperty("order")&&(st[e.order].forEach(function(r){if(null!==r.node){var n=et[r.node];n!==e&&n.y>e.y&&(n.y+=t,r.tracks.forEach(function(e){tt[e.trackID].path[e.segmentID].y+=t}))}else r.tracks.forEach(function(r){tt[r.trackID].path[r.segmentID].y>=e.y&&(tt[r.trackID].path[r.segmentID].y+=t)})}),dt[e.order].length>0&&dt[e.order].forEach(function(r){et[r]!==e&&et[r].y>e.y&&(et[r].y+=t)}))}function G(e,t){var r=0;return e.forEach(function(e){e.tracks.forEach(function(e){null!==e.idealY&&"read"!==tt[e.trackID].type&&(r+=Math.abs(e.idealY-t-tt[e.trackID].path[e.segmentID].y)*tt[e.trackID].width)})}),r}function V(e,t){return e.hasOwnProperty("idealLane")?t.hasOwnProperty("idealLane")?e.idealLane<t.idealLane?-1:e.idealLane>t.idealLane?1:0:-1:t.hasOwnProperty("idealLane")?1:0}function Z(e,t){if(null===e)return null===t?0:-1;if(null===t)return 1;if(e.hasOwnProperty("order")){if(t.hasOwnProperty("order")){if(e.order<t.order)return-1;if(e.order>t.order)return 1;if(e.hasOwnProperty("y")&&t.hasOwnProperty("y")){if(e.y<t.y)return-1;if(e.y>t.y)return 1}return 0}return-1}
return t.hasOwnProperty("order")?1:0}function K(){var e=void 0,t=void 0,r={};qt.forEach(function(n){for(var o=0;o<at&&tt[o].name!==n.track;)o+=1;o<at&&(e=0,tt[o].path.forEach(function(o){null!==o.node&&(r={},t=et[o.node].hasOwnProperty("sequenceLength")?e+et[o.node].sequenceLength-1:e+et[o.node].width-1,e>=n.start&&e<=n.end&&(r.start=0),e<n.start&&t>=n.start&&(r.start=n.start-e),t<=n.end&&t>=n.start&&(r.end=t-e,t<n.end&&(r.continue=!0)),t>n.end&&e<=n.end&&(r.end=n.end-e),r.hasOwnProperty("start")&&(r.type=n.type,r.name=n.name,o.hasOwnProperty("features")||(o.features=[]),o.features.push(r)),e=t+1)}))})}function ee(){tt.forEach(function(e){e.hasOwnProperty("freq")?e.width=Math.round(4*(Math.log(e.freq)+1)):(e.width=15,e.hasOwnProperty("type")&&"read"===e.type&&(e.width=4))})}function te(e){ut.colorScheme=e,$e=d3.select(Ge);p();ut.hideLegendFlag||Ee()}function re(){Qe=Ye.getColorSet(ut.haplotypeColors),Je=Ye.getColorSet(ut.forwardReadColors),ze=Ye.getColorSet(ut.reverseReadColors),Xe=Ye.getColorSet(ut.exonColors)}function ne(e,t){void 0===t&&(t="plain");return e.hasOwnProperty("custom_color")?e.custom_color:e.hasOwnProperty("type")&&"read"===e.type?e.hasOwnProperty("is_reverse")&&!0===e.is_reverse?ze[e.id%ze.length]:Je[e.id%Je.length]:!1===ut.showExonsFlag||"plain"!==t?Qe[e.id%Qe.length]:Xe[e.id%Xe.length]}function oe(e){var t=et[e.path[0].node];return e.path[0].isForward?ie(t,e.firstNodeOffset):ie(t,t.sequenceLength-e.firstNodeOffset)}function ae(e){var t=et[e.path[e.path.length-1].node];return e.path[e.path.length-1].isForward?ie(t,e.finalNodeCoverLength):ie(t,t.sequenceLength-e.finalNodeCoverLength)}function ie(e,t){if(t>e.sequenceLength)return null;var r=e.x-4,n=e.x+e.pixelWidth+4;return r+t/e.sequenceLength*(n-r)}function de(){for(var e=void 0,t=void 0,r=void 0,n=void 0,o=void 0,a=void 0,i=void 0,d=void 0,s=0;s<=lt;s+=1)ct.push(0),ht.push(0);var c=[],h=[];et.forEach(function(e){e.hasOwnProperty("order")&&(c[e.order]=e.x,void 0===h[e.order]?h[e.order]=e.x+e.pixelWidth:h[e.order]=Math.max(h[e.order],e.x+e.pixelWidth))}),tt.forEach(function(s){a="plain",o=ne(s,a),r=s.path[0].y,e="read"!==s.type?"-"===s.sequence[0].charAt(0)?h[s.path[0].order]+20:c[s.path[0].order]-20:oe(s);for(var l=0;l<s.path.length;l+=1)s.path[l].y===r?s.path[l].hasOwnProperty("features")&&(d=l>0&&s.path[l-1].order===s.path[l].order,i=se(s.path[l],c[s.path[l].order],h[s.path[l].order],a,s,e,r,o,d),a=i.highlight,e=i.xStart):(t=s.path[l-1].isForward?h[s.path[l-1].order]:c[s.path[l-1].order],t!==e&&(o=ne(s,a),pt.push({xStart:Math.min(e,t),yStart:r,xEnd:Math.max(e,t),yEnd:r+s.width-1,color:o,id:s.id,type:s.type})),s.path[l].order-1===s.path[l-1].order?(e=t,t=c[s.path[l].order],n=s.path[l].y,o=ne(s,a),ft.push({xStart:e,yStart:r,xEnd:t+1,yEnd:n,width:s.width,color:o,laneChange:Math.abs(s.path[l].lane-s.path[l-1].lane),id:s.id,type:s.type}),e=t,r=n):s.path[l].order+1===s.path[l-1].order?(e=t,t=h[s.path[l].order],n=s.path[l].y,o=ne(s,a),ft.push({xStart:e+1,yStart:r,xEnd:t,yEnd:n,width:s.width,color:o,laneChange:Math.abs(s.path[l].lane-s.path[l-1].lane),id:s.id,type:s.type}),e=t,r=n):s.path[l-1].isForward?(n=s.path[l].y,ce(t,r,n,s.width,o,s.id,s.path[l].order,s.type),e=h[s.path[l].order],r=s.path[l].y):(n=s.path[l].y,he(t,r,n,s.width,o,s.id,s.path[l].order,s.type),e=c[s.path[l].order],r=s.path[l].y),s.path[l].hasOwnProperty("features")&&(d=s.path[l-1].order===s.path[l].order,i=se(s.path[l],c[s.path[l].order],h[s.path[l].order],a,s,e,r,o,d),a=i.highlight,e=i.xStart));t="read"!==s.type?s.path[s.path.length-1].isForward?h[s.path[s.path.length-1].order]+20:c[s.path[s.path.length-1].order]-20:ae(s),pt.push({xStart:Math.min(e,t),yStart:r,xEnd:Math.max(e,t),yEnd:r+s.width-1,color:o,id:s.id,type:s.type})})}function se(e,t,r,n,o,a,i,d,s){var c=void 0,h=n,l=void 0,u=void 0,p=void 0,f=void 0;return t-=8,r+=8,c=et[e.node].hasOwnProperty("sequenceLength")?et[e.node].sequenceLength:et[e.node].width,e.features.sort(function(e,t){return e.start-t.start}),e.features.forEach(function(n){h!==n.type&&(l=ne(o,h),!0===e.isForward?(p=t+Math.round(n.start*(r-t+1)/c),s&&p<t+8&&(f=t+Math.round((n.end+1)*(r-t+1)/c)-1,u=ne(o,n.type),vt.push({xStart:p,yStart:i,xEnd:f,yEnd:i+o.width-1,color:u,id:o.id,type:o.type})),p>a+1&&vt.push({xStart:a,yStart:i,xEnd:p-1,yEnd:i+o.width-1,color:l,id:o.id,type:o.type})):(p=r-Math.round(n.start*(r-t+1)/c),s&&p>r-8&&(f=r-Math.round((n.end+1)*(r-t+1)/c)-1,u=ne(o,n.type),vt.push({xStart:f,yStart:i,xEnd:p,yEnd:i+o.width-1,color:u,id:o.id,type:o.type})),a>p+1&&vt.push({xStart:p+1,yStart:i,xEnd:a,yEnd:i+o.width-1,color:l,id:o.id,type:o.type})),a=p,h=n.type),(n.end<c-1||!n.hasOwnProperty("continue"))&&(l=ne(o,h),!0===e.isForward?(f=t+Math.round((n.end+1)*(r-t+1)/c)-1,vt.push({xStart:a,yStart:i,xEnd:f,yEnd:i+o.width-1,color:l,id:o.id,type:o.type})):(f=r-Math.round((n.end+1)*(r-t+1)/c)-1,vt.push({xStart:f,yStart:i,xEnd:a,yEnd:i+o.width-1,color:l,id:o.id,type:o.type})),a=f+1,h="plain")}),{xStart:a,highlight:h}}function ce(e,t,r,n,o,a,i,d){e+=10*ht[i];var s=Math.min(t,r),c=Math.max(t,r);yt.push({xStart:e-10*ht[i],yStart:t,xEnd:e+5,yEnd:t+n-1,color:o,id:a,type:d}),yt.push({xStart:e+5+7,yStart:s+n+7-1,xEnd:e+5+7+Math.min(7,n)-1,yEnd:c-7+1,color:o,id:a,type:d}),yt.push({xStart:e-10*ht[i],yStart:r,xEnd:e+5,yEnd:r+n-1,color:o,id:a,type:d});var h="M "+(e+5)+" "+c;h+=" Q "+(e+5+7)+" "+c+" "+(e+5+7)+" "+(c-7),h+=" H "+(e+5+7+Math.min(7,n)),h+=" Q "+(e+5+7+Math.min(7,n))+" "+(c+n)+" "+(e+5)+" "+(c+n),h+=" Z ",gt.push({path:h,color:o,id:a,type:d}),h="M "+(e+5)+" "+s,h+=" Q "+(e+5+7+Math.min(7,n))+" "+s+" "+(e+5+7+Math.min(7,n))+" "+(s+n+7),h+=" H "+(e+5+7),h+=" Q "+(e+5+7)+" "+(s+n)+" "+(e+5)+" "+(s+n),h+=" Z ",gt.push({path:h,color:o,id:a,type:d}),ht[i]+=1}function he(e,t,r,n,o,a,i,d){var s=Math.min(t,r),c=Math.max(t,r);e-=10*ct[i],yt.push({xStart:e-6,yStart:t,xEnd:e+10*ct[i],yEnd:t+n-1,color:o,id:a,type:d}),yt.push({xStart:e-5-7-Math.min(7,n),yStart:s+n+7-1,xEnd:e-5-7-1,yEnd:c-7+1,color:o,id:a,type:d}),yt.push({xStart:e-6,yStart:r,xEnd:e+10*ct[i],yEnd:r+n-1,color:o,id:a,type:d});var h="M "+(e-5)+" "+c;h+=" Q "+(e-5-7)+" "+c+" "+(e-5-7)+" "+(c-7),h+=" H "+(e-5-7-Math.min(7,n)),h+=" Q "+(e-5-7-Math.min(7,n))+" "+(c+n)+" "+(e-5)+" "+(c+n),h+=" Z ",gt.push({path:h,color:o,id:a,type:d}),h="M "+(e-5)+" "+s,h+=" Q "+(e-5-7-Math.min(7,n))+" "+s+" "+(e-5-7-Math.min(7,n))+" "+(s+n+7),h+=" H "+(e-5-7),h+=" Q "+(e-5-7)+" "+(s+n)+" "+(e-5)+" "+(s+n),h+=" Z ",gt.push({path:h,color:o,id:a,type:d}),ct[i]+=1}function le(e,t,r){void 0===r&&(r="haplo");var n=new Set;t.forEach(function(e){n.add(e.color)}),n.forEach(function(n){ve(t.filter(ye("color",n)),r),xe(e.filter(ye("color",n)),r)})}function ue(e){var t=void 0,r=void 0;e.forEach(function(e){e.d="M "+(e.x-9)+" "+e.y+" Q "+(e.x-9)+" "+(e.y-9)+" "+e.x+" "+(e.y-9),t=e.x,r=e.y-9,e.width>1&&(t+=e.pixelWidth,e.d+=" L "+t+" "+r),e.d+=" Q "+(t+9)+" "+r+" "+(t+9)+" "+(r+9),t+=9,r+=9,e.contentHeight>0&&(r+=e.contentHeight-0,e.d+=" L "+t+" "+r),e.d+=" Q "+t+" "+(r+9)+" "+(t-9)+" "+(r+9),t-=9,r+=9,e.width>1&&(t-=e.pixelWidth,e.d+=" L "+t+" "+r),e.d+=" Q "+(t-9)+" "+r+" "+(t-9)+" "+(r-9),t-=9,r-=9,e.contentHeight>0&&(r-=e.contentHeight-0,e.d+=" L "+t+" "+r)}),$e.selectAll(".node").data(e).enter().append("path").attr("id",function(e){return e.name}).attr("d",function(e){return e.d}).on("mouseover",be).on("mouseout",Se).on("dblclick",Fe).style("fill","#fff").style("fill-opacity",ut.showExonsFlag?"0.4":"0.6").style("stroke",function(e){return e.hasOwnProperty("custom_stroke")?e.custom_stroke:"black"}).style("stroke-width","2px").append("svg:title").text(function(e){return e.name+" ["+e.fullname+"]"})}function pe(e){0===ut.nodeWidthOption&&$e.selectAll("text").data(e).enter().append("text").attr("x",function(e){return e.x-4}).attr("y",function(e){return e.y+4}).text(function(e){return e.seq}).attr("font-family",'Courier, "Lucida Console", monospace').attr("font-size","14px").attr("fill","black").style("pointer-events","none")}function fe(){for(var e=0;tt[e].name!==Et;)e+=1;var t=tt[e];$e.append("line").attr("x1",0).attr("y1",wt-10).attr("x2",xt).attr("y2",wt-10).attr("stroke-width",1).attr("stroke","black");var r=100;0===ut.nodeWidthOption&&(r=20);var n=t.indexOfFirstBase,o=!1;t.indexSequence.forEach(function(e){for(var t=et[e],a=Math.ceil(n/r)*r;a<n+t.sequenceLength;){ge(a,ie(t,a-n)),o=!0,a+=r}n+=et[e].sequenceLength}),o||ge(t.indexOfFirstBase,et[t.indexSequence[0]].x-4)}function ge(e,t){$e.append("text").attr("x",t).attr("y",wt-13).text("|"+e).attr("font-family",'Courier, "Lucida Console", monospace').attr("font-size","12px").attr("fill","black").style("pointer-events","none")}function ye(e,t){return function(r){return r[e]===t}}function ve(e,t){void 0===t&&(t="haplo"),e=e.filter(ye("type",t)),$e.selectAll("trackRectangles").data(e).enter().append("rect").attr("x",function(e){return e.xStart}).attr("y",function(e){return e.yStart}).attr("width",function(e){return e.xEnd-e.xStart+1}).attr("height",function(e){return e.yEnd-e.yStart+1}).style("fill",function(e){return e.color}).attr("trackID",function(e){return e.id}).attr("class",function(e){return"track"+e.id}).attr("color",function(e){return e.color}).attr("opacity",function(e){return rt[e.id].opacity||1}).on("mouseover",qe).on("mouseout",ke).on("dblclick",Oe).append("svg:title").text(function(e){return e.name})}function me(e,t){return e[6]<t[6]?-1:e[6]>t[6]?1:0}function we(e){void 0===e&&(e="haplo");var t=ft.filter(ye("type",e));t.sort(me),t.forEach(function(e){var t=(e.xStart+e.xEnd)/2,r="M "+e.xStart+" "+e.yStart;r+=" C "+t+" "+e.yStart+" "+t+" "+e.yEnd+" "+e.xEnd+" "+e.yEnd,r+=" V "+(e.yEnd+e.width),r+=" C "+t+" "+(e.yEnd+e.width)+" "+t+" "+(e.yStart+e.width)+" "+e.xStart+" "+(e.yStart+e.width),r+=" Z",e.path=r}),$e.selectAll("trackCurves").data(t).enter().append("path").attr("d",function(e){return e.path}).style("fill",function(e){return e.color}).attr("trackID",function(e){return e.id}).attr("class",function(e){return"track"+e.id}).attr("color",function(e){return e.color}).attr("opacity",function(e){return rt[e.id].opacity||1}).on("mouseover",qe).on("mouseout",ke).on("dblclick",Oe).append("svg:title").text(function(e){return e.name})}function xe(e,t){void 0===t&&(t="haplo"),e=e.filter(ye("type",t)),$e.selectAll("trackCorners").data(e).enter().append("path").attr("d",function(e){return e.path}).style("fill",function(e){return e.color}).attr("trackID",function(e){return e.id}).attr("class",function(e){return"track"+e.id}).attr("color",function(e){return e.color}).on("mouseover",qe).on("mouseout",ke).on("dblclick",Oe)}function Ee(){for(var e='<table class="table-sm table-condensed table-nonfluid"><thead><tr><th>Color</th><th>Trackname</th><th>Show Track</th></tr></thead>',t=[],r=0;r<tt.length;r+=1)"haplo"===tt[r].type&&(e+='<tr><td style="text-align:right"><div class="color-box" style="background-color: '+ne(tt[r],"exon")+';"></div></td>',tt[r].hasOwnProperty("name")?e+="<td>"+tt[r].name+"</td>":e+="<td>"+tt[r].id+"</td>",e+='<td><input type="checkbox" checked=true id="showTrack'+r+'"></td>',t.push(r));e+="</table",$("#legendDiv").html(e),t.forEach(function(e){document.getElementById("showTrack"+e).addEventListener("click",function(){return i(e)},!1)})}function qe(){var e=d3.select(this).attr("trackID");d3.selectAll(".track"+e).style("fill","url(#patternA)")}function be(){d3.select(this).style("stroke-width","4px")}function ke(){var e=d3.select(this).attr("trackID");d3.selectAll(".track"+e).each(function(){var e=d3.select(this).attr("color");d3.select(this).style("fill",e)})}function Se(){d3.select(this).style("stroke-width","2px")}function Oe(){var e=d3.select(this).attr("trackID");console.log(rt[e]),rt[e].clickTarget&&$(rt[e].clickTarget).text(JSON.stringify(rt[e].fullRecord,null,2));for(var t=0;t<Ze.length&&Ze[t].id!==Number(e);)t+=1;t<Ze.length&&(je&&console.log("moving index: "+t),o(t),p())}function Fe(){var e=d3.select(this).attr("id");ut.clickableNodesFlag&&(nt&&ut.showReads?(document.getElementById("hgvmNodeID").value=e,document.getElementById("hgvmPostButton").click()):(document.getElementById("nodeID").value=e,document.getElementById("postButton").click()))}function Ne(){switch(et.forEach(function(e){e.hasOwnProperty("sequenceLength")||(e.sequenceLength=e.seq.length)}),ut.nodeWidthOption){case 1:et.forEach(function(e){e.width=1+Math.log(e.sequenceLength)/Math.log(2),e.pixelWidth=Math.round(8.401*(e.width-1))});break;case 2:et.forEach(function(e){e.width=e.sequenceLength/100,e.pixelWidth=Math.round(8.401*(e.width-1))});break;default:et.forEach(function(e){e.width=e.sequenceLength,$e.append("text").attr("x",0).attr("y",100).attr("id","dummytext").text(e.seq.substr(1)).attr("font-family",'Courier, "Lucida Console", monospace').attr("font-size","14px").attr("fill","black").style("pointer-events","none"),e.pixelWidth=Math.round(document.getElementById("dummytext").getComputedTextLength()),$("#dummytext").remove()})}}function Ie(){for(var e=void 0,t=void 0,r=[],n=[],o=0;o<et.length;o+=1)r.push(new Set),n.push(new Set);var a=void 0;a=nt&&ut.showReads?tt.concat(nt):tt,a.forEach(function(o){for(var a=0;a<o.sequence.length;a+=1)"-"!==o.sequence[a].charAt(0)?(a>0?(e=o.sequence[a-1],r[it.get(o.sequence[a])].add(e),"-"===e.charAt(0)&&r[it.get(o.sequence[a])].add(e.substr(1))):"haplo"===o.type&&r[it.get(o.sequence[a])].add("None"),a<o.sequence.length-1?(e=o.sequence[a+1],n[it.get(o.sequence[a])].add(e),"-"===e.charAt(0)&&n[it.get(o.sequence[a])].add(e.substr(1))):"haplo"===o.type&&n[it.get(o.sequence[a])].add("None")):(e=o.sequence[a].substr(1),a>0?(t=o.sequence[a-1],"-"===t.charAt(0)?n[it.get(e)].add(t.substr(1)):(n[it.get(e)].add(t),n[it.get(e)].add("-"+t))):"haplo"===o.type&&n[it.get(e)].add("None"),a<o.sequence.length-1?(t=o.sequence[a+1],"-"===t.charAt(0)?r[it.get(e)].add(t.substr(1)):(r[it.get(e)].add(t),r[it.get(e)].add("-"+t))):"haplo"===o.type&&r[it.get(e)].add("None"))});for(var i=0;i<et.length;i+=1)n[i]=Array.from(n[i]),r[i]=Array.from(r[i]);if(nt&&ut.showReads){var d=et.slice();d.sort(Z);var s=new Map,c=new Map;d.forEach(function(e){var t=Me(it.get(e.name),r,n);t?(s.set(e.name,s.get(t)+et[it.get(t)].sequenceLength),c.set(e.name,c.get(t))):(s.set(e.name,0),c.set(e.name,e.name))}),nt.forEach(function(e){e.firstNodeOffset+=s.get(e.sequence[0]),e.finalNodeCoverLength+=s.get(e.sequence[e.sequence.length-1]);for(var t=e.sequence.length-1;t>=0;t-=1)Me(it.get(e.sequence[t]),r,n)&&function(){var o=Me(it.get(e.sequence[t]),r,n);Ce(it.get(o),r,n)&&(t>0?(e.sequence.splice(t,1),e.sequenceNew[t].mismatches.forEach(function(e){e.pos+=et[it.get(o)].sequenceLength}),e.sequenceNew[t-1].mismatches=e.sequenceNew[t-1].mismatches.concat(e.sequenceNew[t].mismatches),e.sequenceNew.splice(t,1)):(e.sequence[0]=c.get(e.sequence[0]),e.sequenceNew[t].mismatches.forEach(function(t){t.pos+=s.get(e.sequenceNew[0].nodeName)}),e.sequenceNew[0].nodeName=c.get(e.sequenceNew[0].nodeName)))}()})}for(var h=0;h<et.length;h+=1)if(Ce(h,r,n)&&!Me(h,r,n))for(var l=h;Ce(l,r,n);)l=n[l][0],"-"===l.charAt(0)&&(l=l.substr(1)),l=it.get(l),et[h].hasOwnProperty("sequenceLength")?et[h].sequenceLength+=et[l].sequenceLength:et[h].width+=et[l].width,et[h].seq+=et[l].seq;tt.forEach(function(t){for(var o=t.sequence.length-1;o>=0;o-=1){e=t.sequence[o],"-"===e.charAt(0)&&(e=e.substr(1));Me(it.get(e),r,n)&&t.sequence.splice(o,1)}});for(var u=et.length-1;u>=0;u-=1)Me(u,r,n)&&et.splice(u,1)}function Me(e,t,r){if(1!==t[e].length)return!1;if("None"===t[e][0])return!1;var n=t[e][0];"-"===n.charAt(0)&&(n=n.substr(1));var o=it.get(n);return 1===r[o].length&&("None"!==r[o][0]&&n)}function Ce(e,t,r){if(1!==r[e].length)return!1;if("None"===r[e][0])return!1;var n=r[e][0];"-"===n.charAt(0)&&(n=n.substr(1));var o=it.get(n);return 1===t[o].length&&"None"!==t[o][0]}function Le(){tt.forEach(function(e,t){"read"===e.type&&e.sequenceNew.forEach(function(t,r){t.mismatches.forEach(function(n){for(var o=it.get(t.nodeName),a=et[o],i=ie(a,n.pos),d=r;e.path[d].node!==o;)d+=1;var s=e.path[d].y;if("insertion"===n.type)!ut.showSoftClips&&(n.pos===e.firstNodeOffset&&0===r||n.pos===e.finalNodeCoverLength&&r===e.sequenceNew.length-1)||Pe(i-3,s+7,n.seq,a.y);else if("deletion"===n.type){var c=ie(a,n.pos+n.length);Re(i,c,s+4,a.y)}else if("substitution"===n.type){var h=ie(a,n.pos+n.seq.length);De(i+1,h,s+7,a.y,n.seq)}})})})}function Pe(e,t,r,n){$e.append("text").attr("x",e).attr("y",t).text("*").attr("font-family",'Courier, "Lucida Console", monospace').attr("font-size","12px").attr("fill","black").attr("nodeY",n).on("mouseover",Ae).on("mouseout",Te).append("svg:title").text(r)}function De(e,t,r,n,o){$e.append("text").attr("x",e).attr("y",r).text(o).attr("font-family",'Courier, "Lucida Console", monospace').attr("font-size","12px").attr("fill","black").attr("nodeY",n).attr("rightX",t).on("mouseover",_e).on("mouseout",Ue)}function Re(e,t,r,n){$e.append("line").attr("x1",e).attr("y1",r-1).attr("x2",t).attr("y2",r-1).attr("stroke-width",7).attr("stroke","grey").attr("nodeY",n).on("mouseover",Be).on("mouseout",He)}function Ae(){d3.select(this).attr("fill","red");var e=Number(d3.select(this).attr("x")),t=Number(d3.select(this).attr("y")),r=Number(d3.select(this).attr("nodeY"));$e.append("line").attr("class","insertionHighlight").attr("x1",e+4).attr("y1",t-10).attr("x2",e+4).attr("y2",r+5).attr("stroke-width",1).attr("stroke","black")}function Be(){d3.select(this).attr("stroke","red");var e=Number(d3.select(this).attr("x1")),t=Number(d3.select(this).attr("x2")),r=Number(d3.select(this).attr("y1")),n=Number(d3.select(this).attr("nodeY"));$e.append("line").attr("class","deletionHighlight").attr("x1",e).attr("y1",r-3).attr("x2",e).attr("y2",n+5).attr("stroke-width",1).attr("stroke","black"),$e.append("line").attr("class","deletionHighlight").attr("x1",t).attr("y1",r-3).attr("x2",t).attr("y2",n+5).attr("stroke-width",1).attr("stroke","black")}function _e(){d3.select(this).attr("fill","red");var e=Number(d3.select(this).attr("x")),t=Number(d3.select(this).attr("rightX")),r=Number(d3.select(this).attr("y")),n=Number(d3.select(this).attr("nodeY"));$e.append("line").attr("class","substitutionHighlight").attr("x1",e-1).attr("y1",r-7).attr("x2",e-1).attr("y2",n+5).attr("stroke-width",1).attr("stroke","black"),$e.append("line").attr("class","substitutionHighlight").attr("x1",t+1).attr("y1",r-7).attr("x2",t+1).attr("y2",n+5).attr("stroke-width",1).attr("stroke","black")}function Te(){d3.select(this).attr("fill","black"),d3.selectAll(".insertionHighlight").remove()}function He(){d3.select(this).attr("stroke","grey"),d3.selectAll(".deletionHighlight").remove()}function Ue(){d3.select(this).attr("fill","grey"),d3.selectAll(".substitutionHighlight").remove()}Object.defineProperty(r,"__esModule",{value:!0}),r.create=n,r.changeTrackVisibility=i,r.changeExonVisibility=d,r.setMergeNodesFlag=s,r.setSoftClipsFlag=c,r.setShowReadsFlag=h,r.setColorSet=l,r.setNodeWidthOption=u,r.useColorScheme=te;var We=e("./svghelpers"),Ye=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(We),je=!1,Qe=[],Je=[],ze=[],Xe=[],Ge=void 0,$e=void 0,Ve=[],Ze=[],Ke=[],et=void 0,tt=void 0,rt=void 0,nt=void 0,ot=void 0,at=void 0,it=void 0,dt=void 0,st=[],ct=[],ht=[],lt=void 0,ut={mergeNodesFlag:!1,clickableNodesFlag:!1,showExonsFlag:!1,colorScheme:0,nodeWidthOption:0,showReads:!0,showSoftClips:!0,haplotypeColors:"plainColors",forwardReadColors:"reds",reverseReadColors:"blues",exonColors:"lightColors",hideLegendFlag:!1},pt=[],ft=[],gt=[],yt=[],vt=[],mt=0,wt=0,xt=0,Et=void 0,qt=void 0,bt=!1},{"./svghelpers":3}]},{},[1]);